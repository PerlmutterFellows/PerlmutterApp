<div class="full-page d-flex justify-content-center align-items-center sessions-background">
  <div class="m-4 shadow w-md-75 h-75 row no-gutters justify-content-center align-items-center bg-light">
    <div class="p-2 w-md-75">
      <%= bootstrap_form_for(@group) do |f| %>
        <h3 class="font-weight-light mb-1"><%= title %></h3>
        <h4 class="font-weight-lighter"><%= prompt %></h4>
        <hr />
        <div class="col-md-6 col-xs-12">
          <%= f.text_field :name, autofocus: true, label_as_placeholder: true, input_group_class: 'input-group-lg' %>
        </div>

        <% select_vals = [] %>
        <% id_vals = [] %>

        <% User.all.each do |user| %>
          <% val_label = [user.first_name, user.last_name].join(' ') %>

          <% unless user.phone_number.blank? %>
            <% val_label += " <span class='badge'><i class='fa fa-phone-square' aria-hidden='true'></i> #{user.phone_number}</span>" %>
          <% end %>

          <% unless user.email.blank? %>
            <% val_label += " <span class='badge'><i class='fa fa-envelope-square' aria-hidden='true'></i> #{user.email}</span>" %>
          <% end %>

          <% select_vals.push([val_label, user.id]) %>
          <% select_vals.sort_by!{ |u| u } %>
          <% id_vals.push(user.id.to_s) %>
        <% end %>

        <% selected_vals = [] %>

        <% @group.users.each do |user| %>

          <% if id_vals.include? user.id.to_s %>
            <%  selected_vals.push(user.id.to_s)  %>
          <% end %>
        <% end %>

        <p hidden id="selected_vals"><%= selected_vals %></p>

        <div class="col-md-6 col-xs-12" data-controller="group">
          <%= f.select :users, select_vals, {}, {class: "selectpicker", multiple: "", data: {"live-search": "true", "show-subtext": "true", target: 'group.dropdown'}} %>
        </div>

        <%= f.submit "Submit" %>
        <% if @group.valid? %>
          <%= link_to 'Show', @group, class: "btn btn-primary" %>
        <% end %>
        <%= link_to 'Back', groups_path, class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>